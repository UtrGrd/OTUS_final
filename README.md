# Проектная работа для курса OTUS Administrator Linux. Professional

## Цель

Цель данного выпускного проекта курса OTUS Administrator Linux. Professional состоит в разработке надежной инфраструктуры кластера веб-серверов для сайта на платформе WordPress. Проект предполагает автоматический запуск четырех серверов, каждый из которых обладает специфической функциональностью для обеспечения непрерывной работы системы.

##  Схема проекта
![alt text](shema_act.png?raw=true "Screenshot1")

## Описание инфраструктуры проекта

#### Сервер Testpr1 

Сервер ```Testpr1``` служит граничным сервером с двумя сетевыми интерфейсами: внешним (192.168.56.10) и внутренним, нацеленным на DMZ (10.10.62.10). Доступ к периметру DMZ разрешен посредством протокола HTTPS. В рамках DMZ обрабатываются следующие ресурсы:

* https://wp.lab.local/ - тестовый сайт;
* https://grafana.lab.local/login - панель управления мониторингом и аналитикой;
* https://prometheus.lab.local/targets - система мониторинга. 

На сервере ```Testpr1``` развернут Nginx (прокси-сервер), перенаправляющий запросы к серверам Apache - ```Testpr2``` и ```Testpr3```. 
Для обеспечения безопасности взаимодействия с сервером ```Testpr1``` используются самоподписанные сертификаты SSL/TLS. В процессе конфигурации сервера автоматически генерируются с помощью скрипта, расположенного по пути /etc/nginx/certs/cert-generator.sh. После генерации, пути к сертификатам указываются в конфигурационном файле nginx.conf, что обеспечивает корректное их использование при настройке безопасного соединения.

#### Сервера Testpr2 и Testpr3

На серверах ```Testpr2``` и ```Testpr3```,установлены серверы Apache, которые обрабатывают PHP и WordPress. Благодаря двум серверам обеспечивается балансировка нагрузки и резервирование веб-части (front-end).
В качестве back-end внедрена система MySQL на серверах ```Testpr2``` и ```Testpr3```, настроенных для работы в режиме репликации master-backup. Репликация master-backup предпочтительна для данного проекта, так как она обеспечивает упрощенное управление и меньшие риски конфликтов данных по сравнению с master-master. В сценарии master-backup, запись происходит только на главном сервере, что снижает вероятность возникновения проблем с синхронизацией и обеспечивает высокую отказоустойчивость.
Отказоустойчивость back-end достигается благодаря автоматическому переключению между серверами при сбоях, обеспечиваемому установленным на серверах Keepalived с общим виртуальным IP-адресом для MySQL.

Синхронизация данных между серверами ```Testpr2``` и ```Testpr3``` осуществляется посредством rsync с интервалом одной минуты, что позволяет минимизировать потерю данных при переключении между серверами.

#### Сервер Testpr4

Сервер ```Testpr4``` отвечает за мониторинг и визуализацию данных с помощью систем Prometheus и Grafana. На всех серверах установлены соответствующие ```node_exporter```, а на серверах ```Testpr2``` и ```Testpr3``` - ```mysql_exporter```. В Grafana настроены дашборды для экспортеров.

```Testpr4``` также выполняет функции сервера логирования (Rsyslog) и резервного копирования для серверов ```Testpr2``` и ```Testpr3```. Автоматическое резервное копирование настраивается с помощью скрипта, добавленного в cron на серверах ```Testpr2``` и ```Testpr3```. Скрипт осуществляет резервное копирование базы данных с использованием инструмента mysqldump и копирование данных WordPress на сервер ```Testpr4```. Резервные копии хранятся в директориях /var/backup/testpr* с указанием даты создания, а информация о выполнении процесса резервного копирования записывается в файл ```/var/log/backup.txt``` на серверах ```Testpr2``` и ```Testpr3```.

Сервер ```Testpr4``` принимает логи от Nginx, Apache и MySQL, которые сохраняются в соответствующих директориях ```/var/log/rsyslog/test-pr*```. Централизованное хранение и анализ логов всех серверов облегчает процесс мониторинга и выявления проблем в инфраструктуре.

Для обеспечения безопасности системы на всех серверах используется SELinux. 

## Заключение
В итоге, данный проект представляет собой попытку создать надежную и отказоустойчивую инфраструктуру веб-серверов на базе WordPress, состоящую из четырех серверов, где каждый сервер выполняет специфическую роль. Комплексное взаимодействие серверов обеспечивает приемлемую непрерывность работы системы, балансировку нагрузки, централизованный мониторинг и логирование, а также резервное копирование данных.


#### Дополнения

Для корректного запуска необходимо в файл hosts на хостовой машине добавить следующие строки:
```
192.168.56.10   wp.lab.local
192.168.56.10   grafana.lab.local
192.168.56.10   prometheus.lab.local
```

Данные аутентификации для панели администрирования WordPress: 
- логин - wpadmin, 
- пароль - f7#swo56d@fLR3. 
- URL: https://wp.lab.local/wordpress/wp-admin/

Данные аутентификации для панели визуализации метрик и мониторинга Grafana: 
- логин - admin, 
- пароль - HTdfg78345Kl+k3 
- URL: https://grafana.lab.local/login

##### Перед запуском не забыть добавить архив с актуальными файлами Wordpress в /roles/wordpress/files/


